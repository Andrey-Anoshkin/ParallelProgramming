\documentclass[bachelor, och, referat]{SCWorks}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage{graphicx}

\usepackage[sort,compress]{cite}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{fancyvrb}
\usepackage{longtable}
\usepackage{array}
\usepackage[english,russian]{babel}
\usepackage{tempora}
\usepackage{minted}
\usepackage{import}
\graphicspath{ {./images/} }
%\definecolor{codebg}{rgb}{0.9,0.9,0.9} %описание собственного цвета (почти
%белый) \setminted{         % установка параметров по умолчанию для команд
%бибилиотеки minted bgcolor=codebg, % установка цвета фона программного кода
%linenos=true,   % включение номеров строк в листингах numbersep=5pt,  %
%промежуток между номерами строк и началом строк листинга breaklines}     %
%автоматические переносы строк (когда строки не умещаются)

\usemintedstyle{bw} % включение черно-белого стиля программного кода
	

\usepackage[hidelinks]{hyperref}

\setminted{
	style=bw,
	framesep=2mm, 
	baselinestretch=1.2, 
	fontsize=\footnotesize, 
	linenos,
	breaklines=true
}

\newcommand{\eqdef}{\stackrel {\rm def}{=}}

\newtheorem{lem}{Лемма}

\begin{document}

% Кафедра (в родительном падеже)
\chair{математической кибернетики и компьютерных наук}

% Тема работы
\title{Численное интегрирование, формула Симпсона, вычисление определенных и кратных интегралов}

% Курс
\course{3}

% Группа
\group{311}

% Факультет (в родительном падеже) (по умолчанию "факультета КНиИТ")
%\department{факультета КНиИТ}

% Специальность/направление код - наименование
\napravlenie{02.03.02 "--- Фундаментальная информатика и информационные технологии}

% Для студентки. Для работы студента следующая команда не нужна.
\studenttitle{Студента}

% Фамилия, имя, отчество в родительном падеже
\author{Аношкина Андрея Алексеевича}

% Заведующий кафедрой
\chtitle{к.\,ф.-м.\,н., доцент} % степень, звание
\chname{С.\,В.\,Миронов}

%Научный руководитель (для реферата преподаватель проверяющий работу)
%!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
\satitle{Старший преподаватель} %должность, степень, звание
\saname{М.\,С.\,Портенко}

% Руководитель практики от организации (только для практики, для остальных типов
% работ не используется)
\patitle{к.\,ф.-м.\,н., доцент}
\paname{Д.\,Ю.\,Петров}

% Семестр (только для практики, для остальных типов работ не используется)
\term{6}

% Наименование практики (только для практики, для остальных типов работ не
% используется)
\practtype{учебная}

% Продолжительность практики (количество недель) (только для практики, для
% остальных типов работ не используется)
\duration{2}

% Даты начала и окончания практики (только для практики, для остальных типов
% работ не используется)
\practStart{01.07.2016} \practFinish{14.07.2016}

% Год выполнения отчета
\date{2024}

\maketitle

\tableofcontents

\section{Work 03}

\subsection*{Задание}

Реализовать параллельно один из методов приближенного вычисления двойных
интегралов, а именно метод статистических испытаний.

\subsection*{Метод трапеций}

Пусть и по направлению $x$, и по направлению
$y$ для приближенного вычисления применяется формула трапеций.

\[ F(y_j) \approx h_1 * \sum_{i = 0}^{m} q_{1, i} * f(x_i, y_j) \]

где $q_{1, i} = 0.5$, при $i = 0$ и $i = m$; $q_{1, i} = 1$, при $i = 1, 2, \dots, m - 1$

и 

\[ J \approx h_2 * \sum_{j = 0}^{n} q_{2, j * F(y_j)}\]

где $q_{2, j} = 0.5$, при $j = 0$ и $j = n$; $q_{2, j} = 1$, при $j = 1, 2, \dots, n - 1$

Тогда

\[ J \approx h_1 * h_2 * \sum_{i = 0}^{m} \sum_{j = 0}^{n} q_{ij} * f(x_i, y_j) \]

где $q_{ij} = q_{1, i} * q_{2, j}$

\subsection*{Реализация}

Фрагмент кода решения приведен ниже:

\begin{minted}{cpp}
#include <iostream>
#include <omp.h>
#include <time.h>
#include <cmath>
#define PI 3.1415926535897932384626433832795

using namespace std;

double f1(const double x, const double y, const double a1, const double b1, const double a2, const double b2) {
	return (1 + exp(sin(PI * x) * cos(PI * y))) / (b1 - a1) / (b2 - a2);
}

double q(int i, int j, int n, int m) {
	double q = 1;
	if (i == 0 || i == n)
		q *= 0.5;
	if (j == 0 || j == m)
		q *= 0.5;
	return q;
}

void integral_posl(const double a1, const double b1, const double a2, const double b2, const double h1, const double h2, double* res) {
	double sum = 0;
	int n = (int)((b1 - a1) / h1);
	int m = (int)((b2 - a2) / h2);

	for (int i = 0; i <= n; ++i) {
		double x = a1 + i * h1 + h1 / 2;
		for (int j = 0; j <= m; ++j) {
			double y = a2 + j * h2 + h2 / 2;
			sum += f1(x, y, a1, b1, a2, b2) * h1 * h2 * q(i, j, n, m);
		}
	}

	*res = sum;
}

void integral_paral(const double a1, const double b1, const double a2, const double b2, const double h1, const double h2, double* res) {
	double sum = 0;
	int n = (int)((b1 - a1) / h1);
	int m = (int)((b2 - a2) / h2);

	#pragma omp parallel for reduction(+: sum)
	for (int i = 0; i <= n; ++i) {
		double x = a1 + i * h1 + h1 / 2;
		for (int j = 0; j <= m; ++j) {
			double y = a2 + j * h2 + h2 / 2;
			sum += f1(x, y, a1, b1, a2, b2) * h1 * h2 * q(i, j, n, m);
		}
	}

	*res = sum;
}

double experiment(double* res, void f(const double a1, const double b1, const double a2, const double b2, const double h1, const double h2, double* res)) {
	double stime = 0, ftime = 0;
	double a1 = 0, b1 = 16;
	double a2 = 0, b2 = 16;
	double h1 = 0.005, h2 = 0.005;
	stime = clock();
	f(a1, b1, a2, b2, h1, h2, res);
	ftime = clock();

	return (ftime - stime) / CLOCKS_PER_SEC;
}

void calculate(void f(const double a1, const double b1, const double a2, const double b2, const double h1, const double h2, double* res)) {
	double avg_time = 0;
	double min_time = 0;
	double max_time = 0;
	double res = 0;
	int numbExp = 10;

	min_time = max_time = experiment(&res, f);
	avg_time = min_time / numbExp;
	for (int i = 0; i < numbExp - 1; ++i) {
		double time = experiment(&res, f);
		if (time > max_time)
			max_time = time;
		if (time < min_time)
			min_time = time;

		avg_time += time / numbExp;
	}

	cout << "Execution time: " << avg_time << "; " << min_time << "; " << max_time << "\n";
	cout.precision(8);
	cout << "Integral value: " << res << "\n";
}

int main() {


	cout << "Posl:\n";
	calculate(integral_posl);
	cout << "\n";

	cout << "Paral:\n";
	calculate(integral_paral); 
	cout << "\n";

	system("pause");
	return 0;
}
\end{minted}

\subsection*{Результат работы}

\begin{figure}[H]
	\centering
	\includegraphics[width=\linewidth]{work-3.png}
	\caption{Work-3}
\end{figure}

Значение ускорения выполнения программы при переходе к многопоточной версии:
\[a = \frac{timeSeq}{timePar} = \frac{1.5739}{0.6463} \approx 2.4352\]

\subsection*{Характеристики устройства}

Процессор: Intel(R) Core(TM) i3

Ядер: 4

Оперативная память: 4 Гб

\end{document}
