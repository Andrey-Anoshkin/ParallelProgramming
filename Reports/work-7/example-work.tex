\documentclass[bachelor, och, referat]{SCWorks}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage[sort,compress]{cite}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{fancyvrb}
\usepackage{longtable}
\usepackage{array}
\usepackage[english,russian]{babel}
\usepackage{tempora}
\usepackage{minted}
\usepackage{import}
\graphicspath{ {./images/} }
%\definecolor{codebg}{rgb}{0.9,0.9,0.9} %описание собственного цвета (почти
%белый) \setminted{         % установка параметров по умолчанию для команд
%бибилиотеки minted bgcolor=codebg, % установка цвета фона программного кода
%linenos=true,   % включение номеров строк в листингах numbersep=5pt,  %
%промежуток между номерами строк и началом строк листинга breaklines}     %
%автоматические переносы строк (когда строки не умещаются)

\usemintedstyle{bw} % включение черно-белого стиля программного кода
	

\usepackage[hidelinks]{hyperref}

\setminted{
	style=bw,
	framesep=2mm, 
	baselinestretch=1.2, 
	fontsize=\footnotesize, 
	linenos,
	breaklines=true
}

\newcommand{\eqdef}{\stackrel {\rm def}{=}}

\newtheorem{lem}{Лемма}

\begin{document}

% Кафедра (в родительном падеже)
\chair{математической кибернетики и компьютерных наук}

% Тема работы
\title{Преобразование Фурье. Быстрое преобразование Фурье}

% Курс
\course{3}

% Группа
\group{311}

% Факультет (в родительном падеже) (по умолчанию "факультета КНиИТ")
%\department{факультета КНиИТ}

% Специальность/направление код - наименование
\napravlenie{02.03.02 "--- Фундаментальная информатика и информационные технологии}

% Для студентки. Для работы студента следующая команда не нужна.
\studenttitle{Студента}

% Фамилия, имя, отчество в родительном падеже
\author{Аношкина Андрея Алексеевича}

% Заведующий кафедрой
\chtitle{к.\,ф.-м.\,н., доцент} % степень, звание
\chname{С.\,В.\,Миронов}

%Научный руководитель (для реферата преподаватель проверяющий работу)
%!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
\satitle{Старший преподаватель} %должность, степень, звание
\saname{М.\,С.\,Портенко}

% Руководитель практики от организации (только для практики, для остальных типов
% работ не используется)
\patitle{к.\,ф.-м.\,н., доцент}
\paname{Д.\,Ю.\,Петров}

% Семестр (только для практики, для остальных типов работ не используется)
\term{6}

% Наименование практики (только для практики, для остальных типов работ не
% используется)
\practtype{учебная}

% Продолжительность практики (количество недель) (только для практики, для
% остальных типов работ не используется)
\duration{2}

% Даты начала и окончания практики (только для практики, для остальных типов
% работ не используется)
\practStart{01.07.2016} \practFinish{14.07.2016}

% Год выполнения отчета
\date{2024}

\maketitle

\tableofcontents

\section{Work 07}

\subsection*{Задание}

Проведите эксперименты для последовательного и параллельного вычислений БПФ,
результаты занесите в таблицу. Оцените эффективность динамического планирования
в OpenMP"=версии по сравнению со статическим.

\subsection*{Быстрое преобразование Фурье}

В работе изучаются общие идеи преобразования Фурье и алгоритма быстрого
преобразования Фурье (БПФ) с последующей программной реализацией алгоритма БПФ в
последовательном и параллельном случаях.

\subsection*{Общие сведения}

Основу преобразования Фурье составляет идея о том, что почти любую периодическую
функцию можно представить суммой гармонических составляющих или гармоник
(синусоид с различными амплитудами, фазами и частотами).

Преобразование Фурье позволяет перейти от рассмотрения сигналов во временной
области к их анализу и обработке в частотной области. Во временной области
функция времени задается привычным образом, так как по оси абсцисс откладывается
время. В частотной области функция времени отображается несколько иначе за счет
того, что по оси абсцисс откладывается частота, а по оси ординат – амплитуда
гармоник, составляющих функцию.

Представление функции в частотной области называют спектром функции.

\subsection*{Ряды Фурье}
Пусть функция $f(t)$ представляет собой периодический сигнал, имеющий период
$T$. Ряд Фурье функции $f(t)$ по ортогональной системе функций:
\begin{equation*}
    1, Cos\omega t, Sin \omega t, \dots, Cos k \omega t, Sin k \omega t
\end{equation*}
имеет вид:

\begin{equation*}
    f(t) = \frac{a_0}{2} + a_1 Cos\omega t + b_1 Sin \omega t + \dots + a_k Cos k \omega t + b_k Sin k \omega t + \dots
\end{equation*}
\begin{itemize}
    \item[$\diamondsuit$] Основная частота $\omega = \frac{2 \pi}{2}$ соответствует
периоду $T$, остальные частоты кратны ей.
    \item[$\diamondsuit$] Система функций ортогональна относительно скалярного
произведения вида: $\int_\alpha^ {\alpha + T} g(t) h(t) dt$
    \item [$\diamondsuit$] 
    $a_k = \frac{2}{T} \int_\alpha^ {\alpha + T} f(t) Cos k \cdot \omega t dt$,
    $k = $ 0, 1, \dots
    \item [$\diamondsuit$] 
    $b_k = \frac{2}{T} \int_\alpha^ {\alpha + T} f(t) Sin k \cdot \omega t dt$,
    $k = $ 1, 2, \dots
\end{itemize} 


\subsection*{Дискретное преобразование Фурье}

\begin{itemize}
    \item [$\diamondsuit$]
Рассмотрим выражение для комплексного коэффициента $c_k$:
\begin{equation*}
    \frac{1}{T} \int_\alpha^ {\alpha + T} f(t) \cdot e^{-ik \omega t} dt,
\end{equation*}
где $\omega$ "--- основная частота.
\item [$\diamondsuit$]
Выберем дискретные моменты времени для переведа задачи в дискретную форму.: $t_n
= n \cdot \Delta t$, где $\Delta t$ "--- период дискретизации.
\item [$\diamondsuit$]
Выберем дискретные значения функции в эти моменты: $x_n = f(n \cdot \Delta t)$
(на полном периоде функции оказывается $N$ точек: $N \cdot \Delta t = T$.

\item [$\diamondsuit$]
Подставим полученные выражения в формулу для коэффициентов $c_k$.
\end{itemize}
Таким образом, интеграл аппроксимируется интегральной суммой ($dt$ превратится
в $\Delta t$, также принимается допущение, что за пределами сетки функция
периодически повторяется):

\begin{equation*}
    c_k = \frac{1 \cdot \Delta t}{N \cdot \Delta t} \sum_{n = 0} ^ {N - 1} x_n e^{-\frac{2 \pi \cdot i \cdot n \cdot \Delta t \cdot k}{N \cdot \Delta t}}, k = 0, \dots, N - 1.
\end{equation*}

Масштабный коэффициент $\frac{1}{N}$ не влияет на относительную величину $c_k$,
поэтому указывать его не будем.

Обозначим относительную величину коэффициента $c_k$ через $X(k)$ и получим
выражение для \textbf{\textit{дискретного преобразования Фурье}}:

\begin{equation*}
    X(k) = \sum_{n = 0} ^ {N - 1} x_n e^{-\frac{2 \pi i n k}{N}}, k = 0, \dots, N - 1.
\end{equation*}

Дискретное преобразование Фурье (ДПФ) ставит в соответствие $N$ отсчетам
дискретного сигнала, $N$ отсчетов дискретного спектра, при этом предполагается,
что и сигнал, и спектр являются периодическими и анализируются на одном периоде.
\subsection*{Быстрое преобразование Фурье}

\begin{itemize}
    \item [$\diamondsuit$] Представленная выше формула для вычисления ДПФ требует
    значительных затрат. Трудоемкость такого алгоритма имеет порядок $O(N^2)$.
    \item [$\diamondsuit$] В настоящее время существует целая серия оптимизированных
    алгоритмов расчета ДПФ, которые объединяют под общим названием
    \textbf{\textit{быстрое преобразование Фурье (БПФ, FFT, Fast Fourier
    Transform)}}.
    \item [$\diamondsuit$] БПФ не является аппроксимацией ДПФ. Это в точности ДПФ, но
    с уменьшенным количеством арифметических операций.
    \item [$\diamondsuit$] БПФ "--- это алгоритм эффективного вычисления ДПФ с
    трудоемкостью $O(\frac{N}{2}\log_2 N)$
    
\end{itemize}

\subsection*{Основные концепции БПФ}
Пусть $W_N = e^{-\frac{2 \pi i}{N}}$ "--- \textbf{\textit{комплексный
поворачивающий множитель}}, который постоянен для заданного $N$, тогда выражение
для ДПФ примет вид:
\begin{equation*}
    X(k) = \sum_{n = 0} ^ {N - 1} x_n W_N^{nk}, k = 0, \dots, N - 1.
\end{equation*}

\subsection*{Разделение исходной последовательности прореживанием по времени}
Прореживание по времени заключается в разделении ДПФ на сумму двух ДПФ длиной
$\frac{N}{2}$: одно формируется из компонентов с четными индексами $x_0, x_2,
x_4, \dots,$ другое "--- из компонентов с нечетными индексами $x_1, x_3, x_5,
\dots$
\begin{gather*}
    X(k) = \sum_{n = 0}^{N / 2 - 1} x_{2n} W_N^{2nk} + \sum_{n = 0}^{N / 2 - 1}x_{2n + 1} W_N^{(2n + 1)k}
    \\ = \sum_{n = 0}^{N / 2 - 1} x_{2n} W_{N / 2}^{2nk} + W_N^{k} \sum_{n = 0}^{N / 2 - 1} x_{2n + 1} W_{N / 2}^{2nk}, k = 0, \dots, N - 1.
\end{gather*}

Теперь заменим каждую полученную сумму на две суммы длиной $N / 4$, в свою
очередь состоящие из четных и нечетных слагаемых:

\begin{gather*}
    X(k) = \sum_{n = 0}^{N / 4 - 1} x_{4n} W_{N / 4}^{nk} + W_{N / 2}^{k} + \sum_{n = 0}^{N / 4 - 1}x_{4n + 2} W_{N / 4}^{2nk} + \\ W_N^k \left( \sum_{n = 0} ^ {N / 4 - 1} x_{4n + 1} W_{N / 4}^{nk} + W_{N / 2}^{k} \sum_{n = 0} ^ {N / 4 - 1} x_{4n + 3} W_{N / 4}^{nk} \right), k = 0, \dots, N - 1.
\end{gather*}

И так далее рекурсивно разделяем вычисления на две части, для этого размер
входных данных должен быть степенью двойки: $N = 2^q, q \in N$. Вычисления
разбиваются до тех пор, пока не дойдем до одного элемента. Далее выполняем
фиктивное ДПФ над одним элементом, так как для одного числа поворачивающий
множитель вычислять не нужно и ДПФ над числом $x$ есть само число $x$.

\subsection*{Процедура объединения}

В результате математических преобразований получили, что два ДПФ четных и
нечетных временных отсчетов входного сигнала можно объединить в ДПФ полной
длины, если просуммировать отсчеты четной последовательности с произведением
отсчетов нечетной последовательности входных сигналов на поворачивающий
множитель. Количество операций умножения при этом значительно уменьшается по
сравнению с прямым вычислением ДПФ. 

\subsection*{Последовательная реализация}

Фрагмент кода решения приведен ниже:

\begin{minted}{cpp}
void SerialFFT(complex<double>* inputSignal, complex<double>* outputSignal, int size) {
	BitReversing(inputSignal, outputSignal, size);
	SerialFFTCalculation(outputSignal, size);
}

void ParallelFFTCalculation(complex<double>* signal, int size) {
	int m = 0;
	for (int tmp_size = size; tmp_size > 1; tmp_size /= 2, m++);

	for (int p = 0; p < m; ++p) {
		int butterflyOffset = 1 << (p + 1);
		int butterflySize = butterflyOffset >> 1;
		double coeff = PI / butterflySize;

		#pragma omp parallel for schedule(static)
		for (int i = 0; i < size / butterflyOffset; i++) 
			for (int j = 0; j < butterflySize; j++)
				Butterfly(signal, complex<double>(cos(-j * coeff),
					sin(-j * coeff)), j + i * butterflyOffset, butterflySize);
	}
}
\end{minted}

\subsection*{Параллельная реализация}

Фрагмент кода решения приведен ниже:

\begin{minted}{cpp}
void ParallelFFT(complex<double>* inputSignal, complex<double>* outputSignal, int size) {
	BitReversing(inputSignal, outputSignal, size);
	//ParallelBitReversing(inputSignal, outputSignal, size);
	ParallelFFTCalculation(outputSignal, size);
}

void ParallelFFTCalculation(complex<double>* signal, int size) {
	int m = 0;
	for (int tmp_size = size; tmp_size > 1; tmp_size /= 2, m++);

	for (int p = 0; p < m; ++p) {
		int butterflyOffset = 1 << (p + 1);
		int butterflySize = butterflyOffset >> 1;
		double coeff = PI / butterflySize;

		#pragma omp parallel for schedule(static)
		for (int i = 0; i < size / butterflyOffset; i++) 
			for (int j = 0; j < butterflySize; j++)
				Butterfly(signal, complex<double>(cos(-j * coeff),
					sin(-j * coeff)), j + i * butterflyOffset, butterflySize);
	}
}
\end{minted}

\subsection*{Результат работы}

\begin{figure}[H]
	\centering
	\includegraphics[width=\linewidth]{work-7.png}
	\caption{Work"=7}
\end{figure}

\subsection*{Таблица сравнения}

\begin{table}[H]
\resizebox{\textwidth}{!}{
\begin{tabular}{|c|c|c|c|c|}
\hline
    \multirow{2}{*}{Номер теста} & \multirow{2}{*}{Размер входного сигнала} & \multirow{2}{*}{Последовательный алгоритм} & \multicolumn{2}{|c|}{Параллельный алгоритм}\\
    \cline{4-5}
    & & & Время & Ускорение\\
    \hline
    1 & 32768 & 0.061 & 0.022 & $\approx 2.77$ \\
    \hline
    2 & 65536 & 0.145 & 0.046 & $\approx 3.15$ \\ 
    \hline
    3 & 131072 & 0.278 & 0.093 & $\approx 2.98$ \\ 
    \hline
    4 & 262144 & 0.59 & 0.196 & $\approx 3.01$ \\ 
    \hline
    5 & 524288 & 1.263 & 0.401 & $\approx 3.14$ \\
    \hline
    \label{table-1}
\end{tabular}
}
\end{table}

Использование динамического планирования замедляет работу.

\subsection*{Характеристики устройства}

Процессор: Intel(R) Core(TM) i5"=10400F

Ядер: 6

Оперативная память: 16 Гб

\end{document}
